KEYSTORES AND TRUSTSTORES API
==============================
Timestamp: 2025-12-08_21-42-21_UTC
Resource: keystores

Base Path: /v1/organizations/{organizationId}/environments/{environmentId}/keystores

DESCRIPTION
-----------
Keystores store private keys and certificates for TLS/SSL connections.
Truststores store trusted CA certificates for validating server certificates.
Both are essential for secure API communication.

KEYSTORES OPERATIONS
--------------------

1. LIST /v1/organizations/{org}/environments/{env}/keystores
   Description: Lists all keystores
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
   Response: List of keystore names

2. GET /v1/organizations/{org}/environments/{env}/keystores/{keystore}
   Description: Gets keystore details
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - keystore (path, required): Keystore name
   Response: Keystore object with aliases

3. CREATE /v1/organizations/{org}/environments/{env}/keystores
   Description: Creates a new keystore
   Method: POST
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - name (query, required): Keystore name
   Response: Keystore object

4. DELETE /v1/organizations/{org}/environments/{env}/keystores/{keystore}
   Description: Deletes a keystore
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - keystore (path, required): Keystore name
   Response: Keystore object

ALIASES OPERATIONS (Certificates and Keys)
------------------------------------------

5. LIST /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases
   Description: Lists all aliases in keystore
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - keystore (path, required): Keystore name
   Response: List of alias objects

6. GET /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases/{alias}
   Description: Gets alias details
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - keystore (path, required): Keystore name
     - alias (path, required): Alias name
   Response: Alias object with certificate chain

7. CREATE /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases
   Description: Creates a new alias (uploads certificate/key)
   Method: POST
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - keystore (path, required): Keystore name
     - alias (query, required): Alias name
     - format (query, required): keycertfile, pkcs12, or selfsignedcert
     - password (query, optional): Password for encrypted keys
     - ignoreExpiryValidation (query, optional): Skip expiry checks
     - ignoreNewlineValidation (query, optional): Skip newline checks
   Request Body: Certificate/key file (multipart/form-data)
   Response: Alias object

8. UPDATE /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases/{alias}
   Description: Updates an alias (re-uploads certificate/key)
   Method: POST
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - keystore (path, required): Keystore name
     - alias (path, required): Alias name
     - ignoreExpiryValidation (query, optional): Skip expiry checks
     - ignoreNewlineValidation (query, optional): Skip newline checks
   Request Body: Certificate/key file
   Response: Alias object

9. DELETE /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases/{alias}
   Description: Deletes an alias
   Parameters:
     - org (path, required): Organization ID
     - env (path, required): Environment name
     - keystore (path, required): Keystore name
     - alias (path, required): Alias name
   Response: Alias object

10. GET CERTIFICATE /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases/{alias}/certificate
    Description: Gets certificate details (including chain)
    Parameters:
      - org (path, required): Organization ID
      - env (path, required): Environment name
      - keystore (path, required): Keystore name
      - alias (path, required): Alias name
    Response: Certificate object

11. EXPORT CERTIFICATE /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases/{alias}/certificate
    Description: Exports certificate in PEM format
    Method: GET with Accept: application/x-pem-file
    Response: PEM-formatted certificate

12. GET CSR /v1/organizations/{org}/environments/{env}/keystores/{keystore}/aliases/{alias}/csr
    Description: Generates certificate signing request
    Method: GET
    Response: CSR in PEM format

RESOURCE SCHEMA
---------------
Keystore:
{
  "name": "string",                    // Keystore name
  "aliases": ["string"]                // List of alias names
}

Alias:
{
  "alias": "string",                   // Alias name
  "certsInfo": {                       // Certificate information
    "certInfo": [{
      "version": "string",             // X.509 version
      "subject": "string",             // Subject DN
      "issuer": "string",              // Issuer DN
      "serialNumber": "string",        // Serial number
      "notBefore": "string",           // Valid from
      "notAfter": "string",            // Valid until
      "subjectAlternativeNames": ["string"],  // SANs
      "sigAlgName": "string",          // Signature algorithm
      "publicKey": "string",           // Public key
      "isValid": "string",             // true or false
      "basicConstraints": "string",    // CA constraints
      "keyUsage": ["string"]           // Key usage extensions
    }],
    "certChainInfo": [{               // Certificate chain
      // Same structure as certInfo
    }]
  },
  "type": "string"                     // cert, keycert, or trustcert
}

Certificate:
{
  "certInfo": [{
    "version": "string",
    "subject": "string",
    "issuer": "string",
    "expiryDate": "string",
    "isValid": "string",
    "subjectAlternativeNames": ["string"]
  }]
}

CERTIFICATE FORMATS
-------------------

1. keycertfile: PEM format with private key and certificate
   -----BEGIN PRIVATE KEY-----
   ...
   -----END PRIVATE KEY-----
   -----BEGIN CERTIFICATE-----
   ...
   -----END CERTIFICATE-----
   (Optional: additional certificates for chain)

2. pkcs12: PKCS#12 format (.p12 or .pfx file)
   Binary format, requires password

3. selfsignedcert: Generate self-signed certificate
   Parameters in query string

EXAMPLES
--------
Create keystore:
  POST /v1/organizations/my-org/environments/prod/keystores?name=tls-keystore

List keystores:
  GET /v1/organizations/my-org/environments/prod/keystores

Upload certificate and key:
  POST /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases
    ?alias=my-cert
    &format=keycertfile
  Content-Type: multipart/form-data
  Body: <PEM file with key and cert>

Upload PKCS12:
  POST /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases
    ?alias=my-cert
    &format=pkcs12
    &password=secret
  Body: <PKCS12 file>

Generate self-signed certificate:
  POST /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases
    ?alias=self-signed
    &format=selfsignedcert
    &keySize=2048
    &certValidityInDays=365
    &subjectAlternativeDNS=api.example.com,www.example.com

List aliases:
  GET /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases

Get alias details:
  GET /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases/my-cert

Get certificate:
  GET /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases/my-cert/certificate

Export certificate:
  GET /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases/my-cert/certificate
  Accept: application/x-pem-file

Generate CSR:
  GET /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases/my-cert/csr

Update certificate:
  POST /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases/my-cert
  Body: <New certificate file>

Delete alias:
  DELETE /v1/organizations/my-org/environments/prod/keystores/tls-keystore/aliases/my-cert

Delete keystore:
  DELETE /v1/organizations/my-org/environments/prod/keystores/tls-keystore

COMMON USE CASES
----------------
1. TLS/SSL termination at proxy level
2. Mutual TLS (mTLS) authentication
3. Signing and verifying JWTs
4. Securing backend connections
5. Certificate rotation and renewal
6. Client certificate authentication
7. Validating server certificates

ERROR CODES
-----------
- 404: Keystore or alias not found
- 403: Permission denied
- 409: Alias already exists
- 400: Invalid certificate format or expired
- 422: Certificate validation failed

BEST PRACTICES
--------------
- Use separate keystores for different purposes
- Rotate certificates before expiry
- Use strong key sizes (minimum 2048-bit RSA)
- Implement certificate monitoring and alerting
- Store private keys securely
- Use certificate chains with intermediate CAs
- Test certificate changes in lower environments
- Keep certificate inventory up to date
- Use meaningful alias names
- Document certificate purposes and ownership

SECURITY NOTES
--------------
- Private keys are stored encrypted
- Private keys cannot be exported via API
- Use strong passwords for PKCS12 files
- Limit access with IAM policies
- Audit keystore operations
- Delete unused certificates promptly
- Validate certificate chains
- Check certificate expiry dates regularly

CERTIFICATE USAGE IN POLICIES
------------------------------
Virtual Host (TLS termination):
<VirtualHost name="secure">
  <SSLInfo>
    <Enabled>true</Enabled>
    <KeyStore>ref://tls-keystore</KeyStore>
    <KeyAlias>my-cert</KeyAlias>
  </SSLInfo>
</VirtualHost>

Target Server (mTLS):
<TargetServer name="backend">
  <SSLInfo>
    <Enabled>true</Enabled>
    <ClientAuthEnabled>true</ClientAuthEnabled>
    <KeyStore>ref://client-keystore</KeyStore>
    <KeyAlias>client-cert</KeyAlias>
    <TrustStore>ref://truststore</TrustStore>
  </SSLInfo>
</TargetServer>

NOTES
-----
- Keystores are environment-specific
- Alias names must be unique within keystore
- Certificate changes require proxy redeployment
- Maximum certificate chain length: 10
- Supported key algorithms: RSA, EC
- Expired certificates trigger warnings
